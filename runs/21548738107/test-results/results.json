{
  "config": {
    "configFile": "/home/runner/work/claudetest123/claudetest123/playwright.config.ts",
    "rootDir": "/home/runner/work/claudetest123/claudetest123/e2e",
    "forbidOnly": true,
    "fullyParallel": true,
    "globalSetup": null,
    "globalTeardown": null,
    "globalTimeout": 0,
    "grep": {},
    "grepInvert": null,
    "maxFailures": 0,
    "metadata": {
      "ci": {
        "commitHref": "https://github.com/bjuergens/claudetest123/commit/6c99fa75a1ae74a006274809e2374cc892132c62",
        "commitHash": "6c99fa75a1ae74a006274809e2374cc892132c62",
        "prHref": "https://github.com/bjuergens/claudetest123/pull/12",
        "prTitle": "Add heat balance tracking and expose TickHeatBalance to UI",
        "prBaseHash": "d849e96499b3068686812641e597bbd51ff4b355",
        "buildHref": "https://github.com/bjuergens/claudetest123/actions/runs/21548738107"
      },
      "gitCommit": {
        "shortHash": "6c99fa7",
        "hash": "6c99fa75a1ae74a006274809e2374cc892132c62",
        "subject": "Merge 2fe88285f83485825ddff928ceda099ce77b96a6 into d849e96499b3068686812641e597bbd51ff4b355",
        "body": "Merge 2fe88285f83485825ddff928ceda099ce77b96a6 into d849e96499b3068686812641e597bbd51ff4b355\n",
        "author": {
          "name": "Björn Jürgens",
          "email": "4362465+bjuergens@users.noreply.github.com",
          "time": 1769883203000
        },
        "committer": {
          "name": "GitHub",
          "email": "noreply@github.com",
          "time": 1769883203000
        },
        "branch": "HEAD"
      },
      "gitDiff": "diff --git a/src/game/HeatGame.ts b/src/game/HeatGame.ts\nindex ce415eb..37b538d 100644\n--- a/src/game/HeatGame.ts\n+++ b/src/game/HeatGame.ts\n@@ -21,12 +21,13 @@ import {\n } from './BalanceConfig.js';\n \n import { GridManager, Cell } from './GridManager.js';\n-import { PhysicsEngine, PhysicsEvent } from './PhysicsEngine.js';\n+import { PhysicsEngine, PhysicsEvent, TickHeatBalance } from './PhysicsEngine.js';\n import { UpgradeManager, UpgradeEvent } from './UpgradeManager.js';\n \n // Re-export types for backward compatibility\n export { StructureType, Tier, UpgradeType, SecretUpgradeType };\n export { Cell };\n+export { TickHeatBalance };\n \n export interface UpgradeState {\n   levels: Record<UpgradeType, number>;\n@@ -100,6 +101,7 @@ export class HeatGame {\n   private money: number;\n   private stats: GameStats;\n   private eventListeners: GameEventListener[] = [];\n+  private lastTickHeatBalance: TickHeatBalance | null = null;\n \n   constructor(initialMoney: number = CORE_SETTINGS.STARTING_MONEY) {\n     // Initialize composed components\n@@ -261,6 +263,14 @@ export class HeatGame {\n     return this.gridManager.getFilledCellCount();\n   }\n \n+  /**\n+   * Get the heat balance statistics from the last tick\n+   * Returns null if no tick has been executed yet\n+   */\n+  getLastTickHeatBalance(): TickHeatBalance | null {\n+    return this.lastTickHeatBalance ? { ...this.lastTickHeatBalance } : null;\n+  }\n+\n   // ==========================================================================\n   // MANUAL POWER GENERATION (Clicker)\n   // ==========================================================================\n@@ -458,6 +468,9 @@ export class HeatGame {\n     // Run physics simulation\n     const result = this.physicsEngine.tick();\n \n+    // Store heat balance for UI access\n+    this.lastTickHeatBalance = result.heatBalance;\n+\n     // Sync stats from physics engine (single source of truth for physics-related stats)\n     const physicsStats = this.physicsEngine.getStats();\n     this.stats.totalPowerGenerated = physicsStats.totalPowerGenerated;\ndiff --git a/src/game/PhysicsEngine.ts b/src/game/PhysicsEngine.ts\nindex 8a745c8..4aad122 100644\n--- a/src/game/PhysicsEngine.ts\n+++ b/src/game/PhysicsEngine.ts\n@@ -46,6 +46,31 @@ export interface PhysicsStats {\n   fuelRodsDepletedIce: number;\n }\n \n+/**\n+ * Per-tick heat balance statistics for debugging/display\n+ * Conservation law: heatGenerated = heatVentilated + heatConvertedToPower + heatLostToEnvironment + heatDeltaInGrid\n+ */\n+export interface TickHeatBalance {\n+  /** Heat generated by fuel rods this tick */\n+  heatGenerated: number;\n+  /** Heat removed by ventilators and void cells this tick */\n+  heatVentilated: number;\n+  /** Heat converted to power by turbines this tick */\n+  heatConvertedToPower: number;\n+  /** Heat lost to environment (edge cells) this tick */\n+  heatLostToEnvironment: number;\n+  /** Net change in heat stored in grid (positive = gained, negative = lost) */\n+  heatDeltaInGrid: number;\n+  /** Power sold by substations this tick */\n+  powerSold: number;\n+  /** Money earned from power sales this tick */\n+  moneyEarned: number;\n+  /** Whether the heat balance equation is satisfied (within tolerance) */\n+  isBalanced: boolean;\n+  /** The imbalance amount if not balanced (for debugging) */\n+  imbalance: number;\n+}\n+\n /**\n  * PhysicsEngine handles all physics simulation for the heat game.\n  * It operates on a GridManager and uses upgrade levels for calculations.\n@@ -204,10 +229,12 @@ export class PhysicsEngine {\n \n   /**\n    * Process heat generation from fuel rods\n+   * Returns the total heat generated this tick\n    */\n-  processHeatGeneration(): void {\n+  processHeatGeneration(): number {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n+    let totalHeatGenerated = 0;\n \n     for (let y = 0; y < gridSize; y++) {\n       for (let x = 0; x < gridSize; x++) {\n@@ -234,6 +261,7 @@ export class PhysicsEngine {\n         }\n \n         cell.heat += heatGeneration;\n+        totalHeatGenerated += heatGeneration;\n \n         // Track max temperature for secret unlock tracking\n         if (cell.heat > cell.maxTempReached) {\n@@ -241,6 +269,8 @@ export class PhysicsEngine {\n         }\n       }\n     }\n+\n+    return totalHeatGenerated;\n   }\n \n   /**\n@@ -283,10 +313,12 @@ export class PhysicsEngine {\n \n   /**\n    * Process heat transfer between cells\n+   * Returns the total heat lost to the environment (edge cells)\n    */\n-  processHeatTransfer(): void {\n+  processHeatTransfer(): number {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n+    let totalHeatLostToEnvironment = 0;\n \n     const heatDeltas: number[][] = [];\n     for (let y = 0; y < gridSize; y++) {\n@@ -319,6 +351,7 @@ export class PhysicsEngine {\n           const heatAboveAmbient = cell.heat - CORE_SETTINGS.AMBIENT_TEMPERATURE;\n           const envTransfer = heatAboveAmbient * CORE_SETTINGS.ENVIRONMENT_HEAT_TRANSFER_RATE * edgeCount;\n           heatDeltas[y][x] -= envTransfer;\n+          totalHeatLostToEnvironment += envTransfer;\n         }\n       }\n     }\n@@ -329,30 +362,41 @@ export class PhysicsEngine {\n         grid[y][x].heat = Math.max(0, grid[y][x].heat + heatDeltas[y][x]);\n       }\n     }\n+\n+    return totalHeatLostToEnvironment;\n   }\n \n   /**\n    * Process heat dissipation (ventilators and void cells)\n+   * Returns the total heat removed by ventilation this tick\n    */\n-  processHeatDissipation(): void {\n+  processHeatDissipation(): number {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n+    let totalHeatVentilated = 0;\n \n     for (let y = 0; y < gridSize; y++) {\n       for (let x = 0; x < gridSize; x++) {\n         const cell = grid[y][x];\n         const dissipation = this.getEffectiveHeatDissipation(cell);\n+        // Only count actual heat removed (not more than available)\n+        const actualDissipation = Math.min(dissipation, cell.heat);\n         cell.heat = Math.max(0, cell.heat - dissipation);\n+        totalHeatVentilated += actualDissipation;\n       }\n     }\n+\n+    return totalHeatVentilated;\n   }\n \n   /**\n    * Process power generation (turbines)\n+   * Returns the total heat converted to power this tick\n    */\n-  processPowerGeneration(): void {\n+  processPowerGeneration(): number {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n+    let totalHeatConvertedToPower = 0;\n \n     for (let y = 0; y < gridSize; y++) {\n       for (let x = 0; x < gridSize; x++) {\n@@ -372,18 +416,22 @@ export class PhysicsEngine {\n         cell.heat -= heatConsumed;\n         cell.power += powerGenerated;\n         this.stats.totalPowerGenerated += powerGenerated;\n+        totalHeatConvertedToPower += heatConsumed;\n       }\n     }\n+\n+    return totalHeatConvertedToPower;\n   }\n \n   /**\n    * Process power sale (substations)\n-   * Returns the amount of money earned\n+   * Returns the amount of money earned and power sold\n    */\n-  processPowerSale(): number {\n+  processPowerSale(): { moneyEarned: number; powerSold: number } {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n     let totalEarnings = 0;\n+    let totalPowerSold = 0;\n \n     for (let y = 0; y < gridSize; y++) {\n       for (let x = 0; x < gridSize; x++) {\n@@ -408,6 +456,7 @@ export class PhysicsEngine {\n           const earnings = powerToSell * ECONOMY.MONEY_PER_POWER;\n \n           totalEarnings += earnings;\n+          totalPowerSold += powerToSell;\n           this.stats.totalMoneyEarned += earnings;\n           cell.power -= powerToSell;\n \n@@ -423,7 +472,7 @@ export class PhysicsEngine {\n       }\n     }\n \n-    return totalEarnings;\n+    return { moneyEarned: totalEarnings, powerSold: totalPowerSold };\n   }\n \n   /**\n@@ -499,20 +548,96 @@ export class PhysicsEngine {\n     }\n   }\n \n+  /**\n+   * Calculate total heat stored in the grid\n+   */\n+  getTotalGridHeat(): number {\n+    const grid = this.gridManager.getGridRef();\n+    const gridSize = this.gridManager.getSize();\n+    let totalHeat = 0;\n+\n+    for (let y = 0; y < gridSize; y++) {\n+      for (let x = 0; x < gridSize; x++) {\n+        totalHeat += grid[y][x].heat;\n+      }\n+    }\n+\n+    return totalHeat;\n+  }\n+\n   /**\n    * Run a complete physics tick\n-   * Returns the money earned from power sales\n+   * Returns the money earned, meltdown status, and heat balance statistics\n    */\n-  tick(): { moneyEarned: number; meltdown: boolean } {\n-    this.processHeatGeneration();\n+  tick(): { moneyEarned: number; meltdown: boolean; heatBalance: TickHeatBalance } {\n+    // Capture initial heat state\n+    const heatBefore = this.getTotalGridHeat();\n+\n+    // Process heat generation\n+    const heatGenerated = this.processHeatGeneration();\n+\n+    // Process fuel depletion (no heat changes)\n     this.processFuelDepletion();\n-    this.processHeatTransfer();\n-    this.processHeatDissipation();\n-    this.processPowerGeneration();\n-    const moneyEarned = this.processPowerSale();\n+\n+    // Process heat transfer (includes environment loss)\n+    const heatLostToEnvironment = this.processHeatTransfer();\n+\n+    // Process heat dissipation\n+    const heatVentilated = this.processHeatDissipation();\n+\n+    // Process power generation (converts heat to power)\n+    const heatConvertedToPower = this.processPowerGeneration();\n+\n+    // Process power sale\n+    const { moneyEarned, powerSold } = this.processPowerSale();\n+\n+    // Capture heat after main physics (before meltdown can clear grid)\n+    const heatAfterPhysics = this.getTotalGridHeat();\n+\n+    // Process overheating/meltdowns\n     const meltdown = this.processOverheating();\n+\n+    // Track high heat survival\n     this.trackHighHeatSurvival();\n \n-    return { moneyEarned, meltdown };\n+    // Calculate heat delta (change in stored heat)\n+    const heatDeltaInGrid = heatAfterPhysics - heatBefore;\n+\n+    // Verify heat balance:\n+    // heatGenerated = heatVentilated + heatConvertedToPower + heatLostToEnvironment + heatDeltaInGrid\n+    // Rearranged: heatGenerated - heatVentilated - heatConvertedToPower - heatLostToEnvironment - heatDeltaInGrid = 0\n+    const expectedDelta = heatGenerated - heatVentilated - heatConvertedToPower - heatLostToEnvironment;\n+    const imbalance = expectedDelta - heatDeltaInGrid;\n+\n+    // Use a tolerance for floating point comparison\n+    const TOLERANCE = 0.0001;\n+    const isBalanced = Math.abs(imbalance) < TOLERANCE;\n+\n+    if (!isBalanced) {\n+      console.warn(\n+        `[PhysicsEngine] Heat balance violation detected!\\n` +\n+        `  Generated: ${heatGenerated.toFixed(2)}\\n` +\n+        `  Ventilated: ${heatVentilated.toFixed(2)}\\n` +\n+        `  Converted to power: ${heatConvertedToPower.toFixed(2)}\\n` +\n+        `  Lost to environment: ${heatLostToEnvironment.toFixed(2)}\\n` +\n+        `  Expected delta: ${expectedDelta.toFixed(2)}\\n` +\n+        `  Actual delta: ${heatDeltaInGrid.toFixed(2)}\\n` +\n+        `  Imbalance: ${imbalance.toFixed(4)}`\n+      );\n+    }\n+\n+    const heatBalance: TickHeatBalance = {\n+      heatGenerated,\n+      heatVentilated,\n+      heatConvertedToPower,\n+      heatLostToEnvironment,\n+      heatDeltaInGrid,\n+      powerSold,\n+      moneyEarned,\n+      isBalanced,\n+      imbalance,\n+    };\n+\n+    return { moneyEarned, meltdown, heatBalance };\n   }\n }",
      "actualWorkers": 1
    },
    "preserveOutput": "always",
    "projects": [
      {
        "outputDir": "/home/runner/work/claudetest123/claudetest123/test-results",
        "repeatEach": 1,
        "retries": 2,
        "metadata": {
          "ci": {
            "commitHref": "https://github.com/bjuergens/claudetest123/commit/6c99fa75a1ae74a006274809e2374cc892132c62",
            "commitHash": "6c99fa75a1ae74a006274809e2374cc892132c62",
            "prHref": "https://github.com/bjuergens/claudetest123/pull/12",
            "prTitle": "Add heat balance tracking and expose TickHeatBalance to UI",
            "prBaseHash": "d849e96499b3068686812641e597bbd51ff4b355",
            "buildHref": "https://github.com/bjuergens/claudetest123/actions/runs/21548738107"
          },
          "gitCommit": {
            "shortHash": "6c99fa7",
            "hash": "6c99fa75a1ae74a006274809e2374cc892132c62",
            "subject": "Merge 2fe88285f83485825ddff928ceda099ce77b96a6 into d849e96499b3068686812641e597bbd51ff4b355",
            "body": "Merge 2fe88285f83485825ddff928ceda099ce77b96a6 into d849e96499b3068686812641e597bbd51ff4b355\n",
            "author": {
              "name": "Björn Jürgens",
              "email": "4362465+bjuergens@users.noreply.github.com",
              "time": 1769883203000
            },
            "committer": {
              "name": "GitHub",
              "email": "noreply@github.com",
              "time": 1769883203000
            },
            "branch": "HEAD"
          },
          "gitDiff": "diff --git a/src/game/HeatGame.ts b/src/game/HeatGame.ts\nindex ce415eb..37b538d 100644\n--- a/src/game/HeatGame.ts\n+++ b/src/game/HeatGame.ts\n@@ -21,12 +21,13 @@ import {\n } from './BalanceConfig.js';\n \n import { GridManager, Cell } from './GridManager.js';\n-import { PhysicsEngine, PhysicsEvent } from './PhysicsEngine.js';\n+import { PhysicsEngine, PhysicsEvent, TickHeatBalance } from './PhysicsEngine.js';\n import { UpgradeManager, UpgradeEvent } from './UpgradeManager.js';\n \n // Re-export types for backward compatibility\n export { StructureType, Tier, UpgradeType, SecretUpgradeType };\n export { Cell };\n+export { TickHeatBalance };\n \n export interface UpgradeState {\n   levels: Record<UpgradeType, number>;\n@@ -100,6 +101,7 @@ export class HeatGame {\n   private money: number;\n   private stats: GameStats;\n   private eventListeners: GameEventListener[] = [];\n+  private lastTickHeatBalance: TickHeatBalance | null = null;\n \n   constructor(initialMoney: number = CORE_SETTINGS.STARTING_MONEY) {\n     // Initialize composed components\n@@ -261,6 +263,14 @@ export class HeatGame {\n     return this.gridManager.getFilledCellCount();\n   }\n \n+  /**\n+   * Get the heat balance statistics from the last tick\n+   * Returns null if no tick has been executed yet\n+   */\n+  getLastTickHeatBalance(): TickHeatBalance | null {\n+    return this.lastTickHeatBalance ? { ...this.lastTickHeatBalance } : null;\n+  }\n+\n   // ==========================================================================\n   // MANUAL POWER GENERATION (Clicker)\n   // ==========================================================================\n@@ -458,6 +468,9 @@ export class HeatGame {\n     // Run physics simulation\n     const result = this.physicsEngine.tick();\n \n+    // Store heat balance for UI access\n+    this.lastTickHeatBalance = result.heatBalance;\n+\n     // Sync stats from physics engine (single source of truth for physics-related stats)\n     const physicsStats = this.physicsEngine.getStats();\n     this.stats.totalPowerGenerated = physicsStats.totalPowerGenerated;\ndiff --git a/src/game/PhysicsEngine.ts b/src/game/PhysicsEngine.ts\nindex 8a745c8..4aad122 100644\n--- a/src/game/PhysicsEngine.ts\n+++ b/src/game/PhysicsEngine.ts\n@@ -46,6 +46,31 @@ export interface PhysicsStats {\n   fuelRodsDepletedIce: number;\n }\n \n+/**\n+ * Per-tick heat balance statistics for debugging/display\n+ * Conservation law: heatGenerated = heatVentilated + heatConvertedToPower + heatLostToEnvironment + heatDeltaInGrid\n+ */\n+export interface TickHeatBalance {\n+  /** Heat generated by fuel rods this tick */\n+  heatGenerated: number;\n+  /** Heat removed by ventilators and void cells this tick */\n+  heatVentilated: number;\n+  /** Heat converted to power by turbines this tick */\n+  heatConvertedToPower: number;\n+  /** Heat lost to environment (edge cells) this tick */\n+  heatLostToEnvironment: number;\n+  /** Net change in heat stored in grid (positive = gained, negative = lost) */\n+  heatDeltaInGrid: number;\n+  /** Power sold by substations this tick */\n+  powerSold: number;\n+  /** Money earned from power sales this tick */\n+  moneyEarned: number;\n+  /** Whether the heat balance equation is satisfied (within tolerance) */\n+  isBalanced: boolean;\n+  /** The imbalance amount if not balanced (for debugging) */\n+  imbalance: number;\n+}\n+\n /**\n  * PhysicsEngine handles all physics simulation for the heat game.\n  * It operates on a GridManager and uses upgrade levels for calculations.\n@@ -204,10 +229,12 @@ export class PhysicsEngine {\n \n   /**\n    * Process heat generation from fuel rods\n+   * Returns the total heat generated this tick\n    */\n-  processHeatGeneration(): void {\n+  processHeatGeneration(): number {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n+    let totalHeatGenerated = 0;\n \n     for (let y = 0; y < gridSize; y++) {\n       for (let x = 0; x < gridSize; x++) {\n@@ -234,6 +261,7 @@ export class PhysicsEngine {\n         }\n \n         cell.heat += heatGeneration;\n+        totalHeatGenerated += heatGeneration;\n \n         // Track max temperature for secret unlock tracking\n         if (cell.heat > cell.maxTempReached) {\n@@ -241,6 +269,8 @@ export class PhysicsEngine {\n         }\n       }\n     }\n+\n+    return totalHeatGenerated;\n   }\n \n   /**\n@@ -283,10 +313,12 @@ export class PhysicsEngine {\n \n   /**\n    * Process heat transfer between cells\n+   * Returns the total heat lost to the environment (edge cells)\n    */\n-  processHeatTransfer(): void {\n+  processHeatTransfer(): number {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n+    let totalHeatLostToEnvironment = 0;\n \n     const heatDeltas: number[][] = [];\n     for (let y = 0; y < gridSize; y++) {\n@@ -319,6 +351,7 @@ export class PhysicsEngine {\n           const heatAboveAmbient = cell.heat - CORE_SETTINGS.AMBIENT_TEMPERATURE;\n           const envTransfer = heatAboveAmbient * CORE_SETTINGS.ENVIRONMENT_HEAT_TRANSFER_RATE * edgeCount;\n           heatDeltas[y][x] -= envTransfer;\n+          totalHeatLostToEnvironment += envTransfer;\n         }\n       }\n     }\n@@ -329,30 +362,41 @@ export class PhysicsEngine {\n         grid[y][x].heat = Math.max(0, grid[y][x].heat + heatDeltas[y][x]);\n       }\n     }\n+\n+    return totalHeatLostToEnvironment;\n   }\n \n   /**\n    * Process heat dissipation (ventilators and void cells)\n+   * Returns the total heat removed by ventilation this tick\n    */\n-  processHeatDissipation(): void {\n+  processHeatDissipation(): number {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n+    let totalHeatVentilated = 0;\n \n     for (let y = 0; y < gridSize; y++) {\n       for (let x = 0; x < gridSize; x++) {\n         const cell = grid[y][x];\n         const dissipation = this.getEffectiveHeatDissipation(cell);\n+        // Only count actual heat removed (not more than available)\n+        const actualDissipation = Math.min(dissipation, cell.heat);\n         cell.heat = Math.max(0, cell.heat - dissipation);\n+        totalHeatVentilated += actualDissipation;\n       }\n     }\n+\n+    return totalHeatVentilated;\n   }\n \n   /**\n    * Process power generation (turbines)\n+   * Returns the total heat converted to power this tick\n    */\n-  processPowerGeneration(): void {\n+  processPowerGeneration(): number {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n+    let totalHeatConvertedToPower = 0;\n \n     for (let y = 0; y < gridSize; y++) {\n       for (let x = 0; x < gridSize; x++) {\n@@ -372,18 +416,22 @@ export class PhysicsEngine {\n         cell.heat -= heatConsumed;\n         cell.power += powerGenerated;\n         this.stats.totalPowerGenerated += powerGenerated;\n+        totalHeatConvertedToPower += heatConsumed;\n       }\n     }\n+\n+    return totalHeatConvertedToPower;\n   }\n \n   /**\n    * Process power sale (substations)\n-   * Returns the amount of money earned\n+   * Returns the amount of money earned and power sold\n    */\n-  processPowerSale(): number {\n+  processPowerSale(): { moneyEarned: number; powerSold: number } {\n     const grid = this.gridManager.getGridRef();\n     const gridSize = this.gridManager.getSize();\n     let totalEarnings = 0;\n+    let totalPowerSold = 0;\n \n     for (let y = 0; y < gridSize; y++) {\n       for (let x = 0; x < gridSize; x++) {\n@@ -408,6 +456,7 @@ export class PhysicsEngine {\n           const earnings = powerToSell * ECONOMY.MONEY_PER_POWER;\n \n           totalEarnings += earnings;\n+          totalPowerSold += powerToSell;\n           this.stats.totalMoneyEarned += earnings;\n           cell.power -= powerToSell;\n \n@@ -423,7 +472,7 @@ export class PhysicsEngine {\n       }\n     }\n \n-    return totalEarnings;\n+    return { moneyEarned: totalEarnings, powerSold: totalPowerSold };\n   }\n \n   /**\n@@ -499,20 +548,96 @@ export class PhysicsEngine {\n     }\n   }\n \n+  /**\n+   * Calculate total heat stored in the grid\n+   */\n+  getTotalGridHeat(): number {\n+    const grid = this.gridManager.getGridRef();\n+    const gridSize = this.gridManager.getSize();\n+    let totalHeat = 0;\n+\n+    for (let y = 0; y < gridSize; y++) {\n+      for (let x = 0; x < gridSize; x++) {\n+        totalHeat += grid[y][x].heat;\n+      }\n+    }\n+\n+    return totalHeat;\n+  }\n+\n   /**\n    * Run a complete physics tick\n-   * Returns the money earned from power sales\n+   * Returns the money earned, meltdown status, and heat balance statistics\n    */\n-  tick(): { moneyEarned: number; meltdown: boolean } {\n-    this.processHeatGeneration();\n+  tick(): { moneyEarned: number; meltdown: boolean; heatBalance: TickHeatBalance } {\n+    // Capture initial heat state\n+    const heatBefore = this.getTotalGridHeat();\n+\n+    // Process heat generation\n+    const heatGenerated = this.processHeatGeneration();\n+\n+    // Process fuel depletion (no heat changes)\n     this.processFuelDepletion();\n-    this.processHeatTransfer();\n-    this.processHeatDissipation();\n-    this.processPowerGeneration();\n-    const moneyEarned = this.processPowerSale();\n+\n+    // Process heat transfer (includes environment loss)\n+    const heatLostToEnvironment = this.processHeatTransfer();\n+\n+    // Process heat dissipation\n+    const heatVentilated = this.processHeatDissipation();\n+\n+    // Process power generation (converts heat to power)\n+    const heatConvertedToPower = this.processPowerGeneration();\n+\n+    // Process power sale\n+    const { moneyEarned, powerSold } = this.processPowerSale();\n+\n+    // Capture heat after main physics (before meltdown can clear grid)\n+    const heatAfterPhysics = this.getTotalGridHeat();\n+\n+    // Process overheating/meltdowns\n     const meltdown = this.processOverheating();\n+\n+    // Track high heat survival\n     this.trackHighHeatSurvival();\n \n-    return { moneyEarned, meltdown };\n+    // Calculate heat delta (change in stored heat)\n+    const heatDeltaInGrid = heatAfterPhysics - heatBefore;\n+\n+    // Verify heat balance:\n+    // heatGenerated = heatVentilated + heatConvertedToPower + heatLostToEnvironment + heatDeltaInGrid\n+    // Rearranged: heatGenerated - heatVentilated - heatConvertedToPower - heatLostToEnvironment - heatDeltaInGrid = 0\n+    const expectedDelta = heatGenerated - heatVentilated - heatConvertedToPower - heatLostToEnvironment;\n+    const imbalance = expectedDelta - heatDeltaInGrid;\n+\n+    // Use a tolerance for floating point comparison\n+    const TOLERANCE = 0.0001;\n+    const isBalanced = Math.abs(imbalance) < TOLERANCE;\n+\n+    if (!isBalanced) {\n+      console.warn(\n+        `[PhysicsEngine] Heat balance violation detected!\\n` +\n+        `  Generated: ${heatGenerated.toFixed(2)}\\n` +\n+        `  Ventilated: ${heatVentilated.toFixed(2)}\\n` +\n+        `  Converted to power: ${heatConvertedToPower.toFixed(2)}\\n` +\n+        `  Lost to environment: ${heatLostToEnvironment.toFixed(2)}\\n` +\n+        `  Expected delta: ${expectedDelta.toFixed(2)}\\n` +\n+        `  Actual delta: ${heatDeltaInGrid.toFixed(2)}\\n` +\n+        `  Imbalance: ${imbalance.toFixed(4)}`\n+      );\n+    }\n+\n+    const heatBalance: TickHeatBalance = {\n+      heatGenerated,\n+      heatVentilated,\n+      heatConvertedToPower,\n+      heatLostToEnvironment,\n+      heatDeltaInGrid,\n+      powerSold,\n+      moneyEarned,\n+      isBalanced,\n+      imbalance,\n+    };\n+\n+    return { moneyEarned, meltdown, heatBalance };\n   }\n }",
          "actualWorkers": 1
        },
        "id": "chromium",
        "name": "chromium",
        "testDir": "/home/runner/work/claudetest123/claudetest123/e2e",
        "testIgnore": [],
        "testMatch": [
          "**/*.@(spec|test).?(c|m)[jt]s?(x)"
        ],
        "timeout": 30000
      }
    ],
    "quiet": false,
    "reporter": [
      [
        "html",
        {
          "outputFolder": "playwright-report"
        }
      ],
      [
        "list",
        null
      ],
      [
        "json",
        {
          "outputFile": "test-results/results.json"
        }
      ]
    ],
    "reportSlowTests": {
      "max": 5,
      "threshold": 300000
    },
    "runAgents": "none",
    "shard": null,
    "tags": [],
    "updateSnapshots": "missing",
    "updateSourceMethod": "patch",
    "version": "1.58.0",
    "workers": 1,
    "webServer": {
      "command": "npm run serve",
      "url": "http://localhost:3000",
      "reuseExistingServer": false,
      "timeout": 120000
    }
  },
  "suites": [
    {
      "title": "heat-game.spec.ts",
      "file": "heat-game.spec.ts",
      "column": 0,
      "line": 0,
      "specs": [],
      "suites": [
        {
          "title": "Heat Game E2E Tests",
          "file": "heat-game.spec.ts",
          "line": 40,
          "column": 6,
          "specs": [
            {
              "title": "should load the game and display initial state",
              "ok": true,
              "tags": [],
              "tests": [
                {
                  "timeout": 30000,
                  "annotations": [],
                  "expectedStatus": "passed",
                  "projectId": "chromium",
                  "projectName": "chromium",
                  "results": [
                    {
                      "workerIndex": 0,
                      "parallelIndex": 0,
                      "status": "passed",
                      "duration": 475,
                      "errors": [],
                      "stdout": [],
                      "stderr": [],
                      "retry": 0,
                      "startTime": "2026-01-31T18:14:13.617Z",
                      "annotations": [],
                      "attachments": [
                        {
                          "name": "screenshot",
                          "contentType": "image/png",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-2428b-e-and-display-initial-state-chromium/test-finished-1.png"
                        },
                        {
                          "name": "browser-logs",
                          "contentType": "text/plain",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-2428b-e-and-display-initial-state-chromium/attachments/browser-logs-252e98eebb6d2a6fd5612fd184955e74f7d8fa0e.log"
                        }
                      ]
                    }
                  ],
                  "status": "expected"
                }
              ],
              "id": "6ea310f0033cac01bab6-1f7f90ca45f76c134f4d",
              "file": "heat-game.spec.ts",
              "line": 86,
              "column": 3
            },
            {
              "title": "should place a Fuel Rod on the grid",
              "ok": true,
              "tags": [],
              "tests": [
                {
                  "timeout": 30000,
                  "annotations": [],
                  "expectedStatus": "passed",
                  "projectId": "chromium",
                  "projectName": "chromium",
                  "results": [
                    {
                      "workerIndex": 0,
                      "parallelIndex": 0,
                      "status": "passed",
                      "duration": 645,
                      "errors": [],
                      "stdout": [],
                      "stderr": [],
                      "retry": 0,
                      "startTime": "2026-01-31T18:14:14.320Z",
                      "annotations": [],
                      "attachments": [
                        {
                          "name": "screenshot",
                          "contentType": "image/png",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-05fff-lace-a-Fuel-Rod-on-the-grid-chromium/test-finished-1.png"
                        },
                        {
                          "name": "browser-logs",
                          "contentType": "text/plain",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-05fff-lace-a-Fuel-Rod-on-the-grid-chromium/attachments/browser-logs-daa597c1e58cdd3735064670bc098a56f535a7d5.log"
                        }
                      ]
                    }
                  ],
                  "status": "expected"
                }
              ],
              "id": "6ea310f0033cac01bab6-a31bde006f3c29450fad",
              "file": "heat-game.spec.ts",
              "line": 116,
              "column": 3
            },
            {
              "title": "should place multiple structures and observe heat dynamics",
              "ok": true,
              "tags": [],
              "tests": [
                {
                  "timeout": 30000,
                  "annotations": [],
                  "expectedStatus": "passed",
                  "projectId": "chromium",
                  "projectName": "chromium",
                  "results": [
                    {
                      "workerIndex": 0,
                      "parallelIndex": 0,
                      "status": "passed",
                      "duration": 1233,
                      "errors": [],
                      "stdout": [],
                      "stderr": [],
                      "retry": 0,
                      "startTime": "2026-01-31T18:14:14.981Z",
                      "annotations": [],
                      "attachments": [
                        {
                          "name": "screenshot",
                          "contentType": "image/png",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-edba4-s-and-observe-heat-dynamics-chromium/test-finished-1.png"
                        },
                        {
                          "name": "browser-logs",
                          "contentType": "text/plain",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-edba4-s-and-observe-heat-dynamics-chromium/attachments/browser-logs-a9526112523c68aa24fe78334be3ec2af4a1ba62.log"
                        }
                      ]
                    }
                  ],
                  "status": "expected"
                }
              ],
              "id": "6ea310f0033cac01bab6-2ed04ebe32d9c471053a",
              "file": "heat-game.spec.ts",
              "line": 148,
              "column": 3
            },
            {
              "title": "should demolish a structure with right-click",
              "ok": true,
              "tags": [],
              "tests": [
                {
                  "timeout": 30000,
                  "annotations": [],
                  "expectedStatus": "passed",
                  "projectId": "chromium",
                  "projectName": "chromium",
                  "results": [
                    {
                      "workerIndex": 0,
                      "parallelIndex": 0,
                      "status": "passed",
                      "duration": 549,
                      "errors": [],
                      "stdout": [],
                      "stderr": [],
                      "retry": 0,
                      "startTime": "2026-01-31T18:14:16.229Z",
                      "annotations": [],
                      "attachments": [
                        {
                          "name": "screenshot",
                          "contentType": "image/png",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-53724--structure-with-right-click-chromium/test-finished-1.png"
                        },
                        {
                          "name": "browser-logs",
                          "contentType": "text/plain",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-53724--structure-with-right-click-chromium/attachments/browser-logs-d97b4f4e87a5cc31e1b5dee61d33b7cf6ee7bb2f.log"
                        }
                      ]
                    }
                  ],
                  "status": "expected"
                }
              ],
              "id": "6ea310f0033cac01bab6-ff211d87a2ad19067056",
              "file": "heat-game.spec.ts",
              "line": 185,
              "column": 3
            },
            {
              "title": "should build a power generation setup",
              "ok": true,
              "tags": [],
              "tests": [
                {
                  "timeout": 30000,
                  "annotations": [],
                  "expectedStatus": "passed",
                  "projectId": "chromium",
                  "projectName": "chromium",
                  "results": [
                    {
                      "workerIndex": 0,
                      "parallelIndex": 0,
                      "status": "passed",
                      "duration": 1706,
                      "errors": [],
                      "stdout": [],
                      "stderr": [],
                      "retry": 0,
                      "startTime": "2026-01-31T18:14:16.793Z",
                      "annotations": [],
                      "attachments": [
                        {
                          "name": "screenshot",
                          "contentType": "image/png",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-206ae-ld-a-power-generation-setup-chromium/test-finished-1.png"
                        },
                        {
                          "name": "browser-logs",
                          "contentType": "text/plain",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-206ae-ld-a-power-generation-setup-chromium/attachments/browser-logs-6db27ca250b3a1a4083663dd5a90aeedb0e1a354.log"
                        }
                      ]
                    }
                  ],
                  "status": "expected"
                }
              ],
              "id": "6ea310f0033cac01bab6-abe0096aa1a1c45a3b34",
              "file": "heat-game.spec.ts",
              "line": 216,
              "column": 3
            },
            {
              "title": "should show heat buildup with clustered fuel rods",
              "ok": true,
              "tags": [],
              "tests": [
                {
                  "timeout": 30000,
                  "annotations": [],
                  "expectedStatus": "passed",
                  "projectId": "chromium",
                  "projectName": "chromium",
                  "results": [
                    {
                      "workerIndex": 0,
                      "parallelIndex": 0,
                      "status": "passed",
                      "duration": 1603,
                      "errors": [],
                      "stdout": [],
                      "stderr": [],
                      "retry": 0,
                      "startTime": "2026-01-31T18:14:18.511Z",
                      "annotations": [],
                      "attachments": [
                        {
                          "name": "screenshot",
                          "contentType": "image/png",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-1ce31-up-with-clustered-fuel-rods-chromium/test-finished-1.png"
                        },
                        {
                          "name": "browser-logs",
                          "contentType": "text/plain",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-1ce31-up-with-clustered-fuel-rods-chromium/attachments/browser-logs-4108f70a5376472a80710ba1c287f526e1cfc9b4.log"
                        }
                      ]
                    }
                  ],
                  "status": "expected"
                }
              ],
              "id": "6ea310f0033cac01bab6-ac87d21624a439db98b8",
              "file": "heat-game.spec.ts",
              "line": 253,
              "column": 3
            },
            {
              "title": "should not allow building without sufficient money",
              "ok": true,
              "tags": [],
              "tests": [
                {
                  "timeout": 30000,
                  "annotations": [],
                  "expectedStatus": "passed",
                  "projectId": "chromium",
                  "projectName": "chromium",
                  "results": [
                    {
                      "workerIndex": 0,
                      "parallelIndex": 0,
                      "status": "passed",
                      "duration": 1417,
                      "errors": [],
                      "stdout": [],
                      "stderr": [],
                      "retry": 0,
                      "startTime": "2026-01-31T18:14:20.131Z",
                      "annotations": [],
                      "attachments": [
                        {
                          "name": "screenshot",
                          "contentType": "image/png",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-ee0f6-ng-without-sufficient-money-chromium/test-finished-1.png"
                        },
                        {
                          "name": "browser-logs",
                          "contentType": "text/plain",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-ee0f6-ng-without-sufficient-money-chromium/attachments/browser-logs-67852c21b9cbe344288f7cfb81aa3e88ded21441.log"
                        }
                      ]
                    }
                  ],
                  "status": "expected"
                }
              ],
              "id": "6ea310f0033cac01bab6-b096005e15a85f67c2a8",
              "file": "heat-game.spec.ts",
              "line": 291,
              "column": 3
            },
            {
              "title": "should handle rapid clicking on the grid",
              "ok": true,
              "tags": [],
              "tests": [
                {
                  "timeout": 30000,
                  "annotations": [],
                  "expectedStatus": "passed",
                  "projectId": "chromium",
                  "projectName": "chromium",
                  "results": [
                    {
                      "workerIndex": 0,
                      "parallelIndex": 0,
                      "status": "passed",
                      "duration": 1239,
                      "errors": [],
                      "stdout": [],
                      "stderr": [],
                      "retry": 0,
                      "startTime": "2026-01-31T18:14:21.561Z",
                      "annotations": [],
                      "attachments": [
                        {
                          "name": "screenshot",
                          "contentType": "image/png",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-c664c--rapid-clicking-on-the-grid-chromium/test-finished-1.png"
                        },
                        {
                          "name": "browser-logs",
                          "contentType": "text/plain",
                          "path": "/home/runner/work/claudetest123/claudetest123/test-results/heat-game-Heat-Game-E2E-Te-c664c--rapid-clicking-on-the-grid-chromium/attachments/browser-logs-8830c25d0c901f07d14f24299509ec6ff3fc0a0b.log"
                        }
                      ]
                    }
                  ],
                  "status": "expected"
                }
              ],
              "id": "6ea310f0033cac01bab6-1b3f7a34798ed668be9c",
              "file": "heat-game.spec.ts",
              "line": 333,
              "column": 3
            }
          ]
        }
      ]
    }
  ],
  "errors": [],
  "stats": {
    "startTime": "2026-01-31T18:14:07.572Z",
    "duration": 15306.237,
    "expected": 8,
    "skipped": 0,
    "unexpected": 0,
    "flaky": 0
  }
}